<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
<f:view>
    <h:head>
        <title>Импорт объектов</title>
        <h:outputStylesheet library="css" name="styles.css"/>
    </h:head>
    <h:body styleClass="#{userSessionBean.admin ? 'admin-mode' : ''}">
        <div class="container">
            <h1>Импорт объектов</h1>

            <div class="card">
                <h:panelGroup rendered="#{userSessionBean.admin}">
                    <p class="text-muted">Режим администратора: отображаются операции всех пользователей.</p>
                </h:panelGroup>
                <h:panelGroup rendered="#{not userSessionBean.admin}">
                    <p class="text-muted">Отображаются операции пользователя: #{userSessionBean.username}</p>
                </h:panelGroup>
            </div>

            <h:messages globalOnly="true" styleClass="messages" showSummary="true" showDetail="true"/>

            <div class="card">
                <h2>Загрузка JSON</h2>
                <h:form id="importForm" enctype="multipart/form-data">
                    <div class="form-group">
                        <h:outputLabel value="Файл (JSON массив объектов)" for="file"/>
                        <h:inputFile id="file" value="#{importBean.file}" required="true"/>
                    </div>
                    <h:commandButton id="importBtn" value="Импортировать" action="#{importBean.importFile}"
                                     styleClass="btn btn-primary"/>
                </h:form>
                <h:form>
                    <h:commandButton value="На главную" action="#{navigationBean.goToHome}"
                                     styleClass="btn btn-secondary"/>
                </h:form>
            </div>

            <div class="card">
                <h2>История импорта</h2>
                <h:panelGroup rendered="#{empty importBean.operations}">
                    <p class="text-muted">Нет операций импорта.</p>
                </h:panelGroup>
                <h:panelGroup rendered="#{not empty importBean.operations}">
                    <table class="table">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>Статус</th>
                            <th>Пользователь</th>
                            <th>Добавлено</th>
                            <th>Дата</th>
                            <th>Ошибка</th>
                        </tr>
                        </thead>
                        <tbody>
                        <ui:repeat value="#{importBean.operations}" var="op">
                            <tr>
                                <td>#{op.id}</td>
                                <td>#{op.status}</td>
                                <td>#{op.username}</td>
                                <td>#{op.addedCount}</td>
                                <td>#{importBean.formatDate(op.createdAt)}</td>
                                <td>#{op.errorMessage}</td>
                            </tr>
                        </ui:repeat>
                        </tbody>
                    </table>
                </h:panelGroup>
            </div>

<!--            <h:messages globalOnly="true" styleClass="messages"/>-->
        </div>
    </h:body>
</f:view>
</html>
